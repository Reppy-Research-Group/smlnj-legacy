// A template for creating release notes for a version
//
:version: 110.99.4
:date: August 1, 2023
:dist-dir: https://smlnj.org/dist/working/{version}/
:history: {dist-dir}HISTORY.html
:issue-base: https://github.com/smlnj/legacy/issues/
:pull-base: https://github.com/smlnj/legacy/pull/
:stem: latexmath
:source-highlighter: pygments
:stylesheet: release-notes.css
:notitle:

= Standard ML of New Jersey Release Notes

[subs=attributes]
++++
<div class="smlnj-banner">
  <span class="title"> Standard ML of New Jersey <br/> Release Notes </span>
  <br/> <br/>
  <span class="subtitle"> Version {version} <br/> {date} </span>
</div>
++++

''''''''
--
SML/NJ HOME::
  https://www.smlnj.org/index.html[[.tt]#https://smlnj.org#]
FILES::
  {dist-dir}index.html[[.tt]#{dist-dir}#]
--
''''''''

== Summary

This patch release fixes a number of bugs in the "legacy" version
of *SML/NJ*.

== Details

=== MLRISC

Modified the way that zero-extension (`ZX`) is handled when the source bit width is
smaller than the target.  Previously, the code assumed that the high bits would be
zero, but as demonstrated by {issue-base}/272[issue #272], this is not guaranteed,
so we now mask out the high bits.

=== SML/NJ Library

--
  * Added the `NativeInt` and `NativeWord` structure aliases to provide
    a portable way to refer to the native numeric types in signatures.

  * Reimplementation of the `Random` structure to use the Mersenne Twister
    algorithm.  There are both 32-bit and 64-bit versions of the generator
    (which one is included depends on the target platform).

  * Reworked the code for determining the maximum hash-table size (used
    in the `HashSetFn` and `HashTableRep` modules) so that it does not
    depend on `Int.int` and `Word.word` being the same size (an issue
    for MLton).  Also split that code out into the internal `MaxHashTableSize`
    module.

  * Added support for the end-of-line assertion ("$") and full support for
    intervals to the Thompson engine in the RegExp library.
--

=== Installation

Added *macOS* 14 (Sonoma) as a recognized system.

=== 32-bit macOS issues

While the {dist-dir}smlnj-x86-{version}.pkg[x86 installer]
for {version} works on **macOs** 10.14 Mojave, building from source
requires some extra steps because the version of **Xcode**
distributed for Mojave does not include a 32-bit SDK.

== Bugs

Here is a list of the issues and pull requests that are fixed (or closed) with
this release.
We include the original bug numbers for bugs that were reported using the
https://smlnj-gforge.cs.uchicago.edu/projects/smlnj-bugs[gforge bug tracker].

[.buglist,cols="^1,<10,^2",strips="none",options="header"]
|=======
| Issue
| Description
| Gforge Bug
| [.bugid]#256#
| {issue-base}/256[Initial numbers generated by `Util/random.sml` have unexpected regularities]
| **n.a.**
| [.bugid]#258#
| {issue-base}/258[Thompson NFA regex engine doesnâ€™t advance stream position when matching]
| **n.a.**
| [.bugid]#260#
| {issue-base}/260[64-bit word literals are parsed incorrectly on 32-bit systems]
| **n.a.**
| [.bugid]#264#
| {pull-base}/264[Fix `VectorSlice.all` and `ArraySlice.all`]
| **n.a.**
| [.bugid]#266#
| {pull-base}/266[config: restore PPC for 10.4 and 10.6]
| **n.a.**
| [.bugid]#267#
| {pull-base}/267[Update makefile]
| **n.a.**
| [.bugid]#272#
| {issue-base}/272[Calling C function via NLFFI binding may give result outside range of its C return type]
| **n.a.**
| [.bugid]#278#
| {issue-base}/278[`CharBuffer.addSlice` does not properly handle starting offsets]
| **n.a.**
| [.bugid]#279#
| {issue-base}/279[`HashSetFn`'s calculation of `maxSize` can cause `Overflow` during functor instantiation]
| **n.a.**
|=======

The following unnumbered bugs were also fixed:
--
  * The `ULexBuffer.getu` function did not handle 4-byte UTF-8 sequences in some
    situations.

  * The `ULexBuffer.getu` function did not reject surrogate halves or too-large
    codepoints.
--

== Supported systems

We believe that SML/NJ will build and run on the following systems, but have only
tested some of them:

[.support-table,cols="^2s,^4v,^3v",options="header",strips="none"]
|=======
| Architecture | Operating System | Status
| AMD64 | FreeBSD 12.0 |
| | macOS 10.14 (Mojave) | Tested
| | macOS 10.15 (Catalina) | Tested
| | macOS 11 (Big Sur) | Tested
| | macOS 12 (Monterey) | Tested
| | macOS 13 (Ventura) | Tested
| | macOS 14 (Sonoma beta) | Tested
| | Ubuntu 20.04.3 LTS | Tested
| {nbsp} | |
| Power PC | Mac OS X 10.5 (Leopard) |
| | AIX |
| {nbsp} | |
| Sparc | Solaris |
| | Linux |
| {nbsp} | |
| x86 (32-bit) | Mac OS X 10.6 (Snow Leopard) |
| | Mac OS X 10.7 (Lion) |
| | Mac OS X 10.8 (Mountain Lion) |
| | Mac OS X 10.9 (Mavericks) |
| | Mac OS X 10.10 (Yosemite) |
| | Mac OS X 10.11 (El Capitan) |
| | macOS 10.12 (Sierra) |
| | macOS 10.13 (High Sierra) |
| | macOS 10.14 (Mojave) |
| | Ubuntu 16.04.3 LTS |
| | Other Linux variants |
| | FreeBSD 12.0 |
| | Other BSD variants |
| | Windows 7 |
| | Windows 10 |
| | Cygwin (32-bit) |
| {nbsp} | |
|=======
